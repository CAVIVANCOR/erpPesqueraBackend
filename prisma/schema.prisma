generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AccesoInstalacion {
  id                          BigInt                     @id @default(autoincrement())
  sedeId                      BigInt
  areaDestinoVisitaId         BigInt?
  empresaId                   BigInt?
  tipoAccesoId                BigInt
  tipoPersonaId               BigInt?
  motivoId                    BigInt?
  tipoEquipoId                BigInt?
  fechaHora                   DateTime
  nombrePersona               String?
  tipoDocIdentidadId          BigInt?
  numeroDocumento             String?
  vehiculoNroPlaca            String?
  vehiculoMarca               String?
  equipoMarca                 String?
  equipoSerie                 String?
  personaFirmaDestinoVisitaId BigInt?
  observaciones               String?
  incidenteResaltante         Boolean                    @default(false)
  descripcionIncidente        String?
  imprimeTicketIng            Boolean                    @default(false)
  urlImpresionTicket          String?
  urlDocumentoVisitante       String?
  createdAt                   DateTime                   @default(now())
  vehiculoColor               String?
  vehiculoModelo              String?
  accesoSellado               Boolean                    @default(false)
  fechaHoraSalidaDefinitiva   DateTime?

  tipoAcceso         TipoAccesoInstalacion @relation(fields: [tipoAccesoId], references: [id])
  tipoPersona        TipoPersona?          @relation(fields: [tipoPersonaId], references: [id])
  motivoAcceso       MotivoAcceso?         @relation(fields: [motivoId], references: [id])
  detalles   AccesoInstalacionDetalle[]
  tipoEquipo        TipoEquipo?          @relation(fields: [tipoEquipoId], references: [id])
}

model AccesoInstalacionDetalle {
  id                   BigInt               @id @default(autoincrement())
  accesoInstalacionId  BigInt
  fechaHora            DateTime
  tipoMovimientoId     BigInt
  areaDestinoVisitaId  BigInt?
  observaciones        String?
  createdAt            DateTime             @default(now())

  accesoInstalacion    AccesoInstalacion @relation(fields: [accesoInstalacionId], references: [id])
  tipoMovimiento       TipoMovimientoAcceso @relation(fields: [tipoMovimientoId], references: [id])
}

model AccesosUsuario {
  id                 BigInt           @id @default(autoincrement())
  usuarioId          BigInt
  submoduloId        BigInt
  puedeVer           Boolean          @default(true)
  puedeCrear         Boolean          @default(false)
  puedeEditar        Boolean          @default(false)
  puedeEliminar      Boolean          @default(false)
  fechaOtorgado      DateTime         @default(now())
  puedeReactivarDocs Boolean          @default(false)
  puederAprobarDocs  Boolean          @default(false)
  puederRechazarDocs Boolean          @default(false)

  usuario        Usuario          @relation(fields: [usuarioId], references: [id])
  submodulo      SubmoduloSistema @relation(fields: [submoduloId], references: [id])
}

model AccionesPreviasFaena {
  id                             BigInt                           @id @default(autoincrement())
  nombre                         String                           @db.VarChar(100)
  descripcion                    String?
  activo                         Boolean                          @default(true)
  paraPescaConsumo               Boolean                          @default(false)
  paraPescaIndustrial            Boolean                          @default(false)

  detalles    DetAccionesPreviasFaena[]
  detallesConsumo DetAccionesPreviasFaenaConsumo[]
}


model Activo {
  id                   BigInt                 @id @default(autoincrement())
  empresaId            BigInt
  tipoId               BigInt
  nombre               String
  descripcion          String?
  cesado               Boolean                @default(false)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime

  tipo        TipoActivo @relation(fields: [tipoId], references: [id])
  permisos    DetallePermisoActivo[]
  embarcacion Embarcacion?
}

model AgrupacionEntidad {
  id               BigInt             @id @default(autoincrement())
  nombre           String             @db.VarChar(100)
  descripcion      String?
  esCliente        Boolean            @default(false)
  esProveedor      Boolean            @default(false)

  entidades   EntidadComercial[]
}

/// Modelo centralizado para almacenar archivos adjuntos PDF de cualquier submódulo del ERP Megui.
/// Permite asociar cada archivo a un proceso origen (empresa, pesca, proveedor, etc.) mediante subModuloId.
model ArchivoAdjunto {
  id             BigInt   @id @default(autoincrement()) // Identificador único del archivo adjunto
  nombreArchivo  String   // Nombre físico del archivo almacenado (ej: permiso-2025-1623456789.pdf)
  rutaRelativa   String   // Ruta relativa de almacenamiento (ej: /uploads/adjuntos/empresa-23/permiso-2025-1623456789.pdf)
  fechaSubida    DateTime @default(now()) // Fecha y hora de subida del archivo
  empresaId      BigInt   // Identificador de la empresa a la que pertenece el archivo adjunto
  subModuloId    BigInt   // Identificador del submódulo o proceso origen (ej: id de pesca, id de empresa, id de proveedor, etc.)
  usuarioSubioId BigInt?  // Usuario que subió el archivo (opcional)
}

model AreaFisicaSede {
  id           BigInt       @id @default(autoincrement())
  sedeId       BigInt
  nombre       String
  descripcion  String?
  cesado       Boolean      @default(false)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime

  sede        SedesEmpresa @relation(fields: [sedeId], references: [id])
}

model AsientoContableInterfaz {
  id               BigInt         @id @default(autoincrement())
  movimientoCajaId BigInt
  fechaContable    DateTime
  cuentaContable   String
  descripcion      String?
  debe             Decimal
  haber            Decimal
  monedaId         BigInt
  empresaId        BigInt
  referenciaExtId  String?
  tipoReferenciaId BigInt?
  estado           String
  fechaEnvio       DateTime?

  movimientoCaja      MovimientoCaja @relation(fields: [movimientoCajaId], references: [id])
}

model Banco {
  id              BigInt            @id @default(autoincrement())
  nombre          String
  codigoSwift     String?
  codigoBcrp      String?
  paisId          BigInt?
  activo          Boolean           @default(true)

  cuentas     CuentaCorriente[]
}

model BolicheRed {
  id                BigInt              @id @default(autoincrement())
  activoId          BigInt              @unique
  descripcion       String?
  cesado            Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  altoM             Decimal?
  estadoActivoId    BigInt
  largoContraido    Decimal?
  largoExpandido    Decimal?
  nroFlotadores     Int?
  nroPlomos         Int?
  urlBolicheRedPdf  String?
  paraPescaConsumo  Boolean @default(false)
  paraPescaIndustrial Boolean @default(false)

  faenas FaenaPesca[] @relation("BolicheFaenas")
  faenasConsumo FaenaPescaConsumo[] @relation("BolicheFaenasConsumo")
}

model Cala {
  id                  BigInt               @id @default(autoincrement())
  bahiaId             BigInt
  motoristaId         BigInt
  patronId            BigInt
  embarcacionId       BigInt
  faenaPescaId        BigInt
  fechaHoraInicio     DateTime?
  fechaHoraFin        DateTime?
  latitud             Decimal?
  longitud            Decimal?
  profundidadM        Decimal?
  toneladasCapturadas Decimal?
  observaciones       String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  temporadaPescaId    BigInt

  faenaPesca            FaenaPesca @relation(fields: [faenaPescaId], references: [id])
  especiesPescadas      DetalleCalaEspecie[]
}

model CalaFaenaConsumo {
  id                  BigInt                @id @default(autoincrement())
  bahiaId             BigInt
  motoristaId         BigInt
  patronId            BigInt
  embarcacionId       BigInt
  faenaPescaConsumoId BigInt
  fechaHoraInicio     DateTime?
  fechaHoraFin        DateTime?
  latitud             Decimal?
  longitud            Decimal?
  profundidadM        Decimal?
  toneladasCapturadas Decimal?
  observaciones       String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  novedadPescaConsumoId          BigInt

  faenaPescaConsumo     FaenaPescaConsumo @relation(fields: [faenaPescaConsumoId], references: [id])
  especiesPescadas DetCalaPescaConsumo[]
}

model CargosPersonal {
  id          BigInt     @id @default(autoincrement())
  descripcion String?
  cesado      Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime

  personal    Personal[]
}

model CategoriaCCosto {
  id          BigInt        @id @default(autoincrement())
  nombre      String        @db.VarChar(50)
  descripcion String?
  activo      Boolean       @default(true)

  centros     CentroCosto[]
}

model CentroCosto {
  Codigo             String               @db.VarChar(20)
  Nombre             String               @db.VarChar(255)
  Descripcion        String?
  CategoriaID        BigInt
  ParentCentroID     String?              @db.VarChar(20)
  id                 BigInt               @id @default(autoincrement())

  categoria       CategoriaCCosto @relation(fields: [CategoriaID], references: [id])
  empresasCentro EmpresaCentroCosto[]
}

model Color {
  id       BigInt     @id @default(autoincrement())
  nombre   String     @db.VarChar(80)
  productos               Producto[]
}

model ConceptoMovAlmacen {
  id                    BigInt                @id @default(autoincrement())
  descripcion           String                @db.VarChar(100)
  descripcionArmada     String                @db.VarChar(255)
  almacenOrigenId       BigInt?
  almacenDestinoId      BigInt?
  llevaKardexOrigen     Boolean               @default(false)
  llevaKardexDestino    Boolean               @default(false)
  esCustodia            Boolean               @default(false)
  tipoConceptoId        BigInt
  tipoMovimientoId      BigInt
  tipoAlmacenId         BigInt
  activo                Boolean               @default(true)

  movimientos      MovimientoAlmacen[]
  tipoConcepto     TipoConcepto  @relation(fields: [tipoConceptoId], references: [id])
  tipoMovimiento   TipoMovimientoAlmacen @relation(fields: [tipoMovimientoId], references: [id])
  tipoAlmacen      TipoAlmacen   @relation(fields: [tipoAlmacenId], references: [id])
  kardexAlmacenes KardexAlmacen[]
}

model Almacen {
  id                 BigInt           @id @default(autoincrement())
  tipoAlmacenamientoId BigInt
  tipoAlmacenId      BigInt
  nombre             String
  descripcion        String?
  activo             Boolean          @default(true)
  centroAlmacenId    BigInt
  seLlevaKardex      Boolean          @default(false)
  esAlmacenExterno   Boolean          @default(false)
  esAlmacenPropioSede Boolean          @default(false)
  esAlmacenProduccion Boolean          @default(false)


  centroAlmacen CentrosAlmacen @relation(fields: [centroAlmacenId], references: [id])
  tipoAlmacenamiento TipoAlmacenamiento @relation(fields: [tipoAlmacenamientoId], references: [id])
  tipoAlmacen TipoAlmacen @relation(fields: [tipoAlmacenId], references: [id])
}

model CentrosAlmacen {
  id                 BigInt           @id @default(autoincrement())
  nombre             String
  descripcion        String?
  activo             Boolean          @default(true)
  proveedorId        BigInt?
  esCentroExterno    Boolean          @default(false)
  esCentroPropioSede       Boolean          @default(false)
  esCentroProduccion Boolean          @default(false)
  empresaId BigInt

  almacenes Almacen[]

}


model ContactoEntidad {
  id                 BigInt           @id @default(autoincrement())
  entidadComercialId BigInt
  nombres            String
  cargoId            BigInt?
  telefono           String?
  correoCorportivo   String?
  correoPersonal     String?
  compras            Boolean          @default(false)
  ventas             Boolean          @default(false)
  finanzas           Boolean          @default(false)
  logistica          Boolean          @default(false)
  representanteLegal Boolean          @default(false)
  observaciones      String?
  activo             Boolean          @default(true)

   entidadComercial   EntidadComercial @relation(fields: [entidadComercialId], references: [id])
}

model CotizacionVentas {
  id                             BigInt                   @id @default(autoincrement())
  empresaId                      BigInt
  fechaRegistro                  DateTime                 @default(now())
  tipoProductoId                 BigInt
  respVentasId                   BigInt
  fechaEntrega                   DateTime
  autorizaVentaId                BigInt
  tipoCambio                     Decimal
  contactoClienteId              BigInt
  clienteId                      BigInt
  bancoId                        BigInt
  formaPagoId                    BigInt
  respEmbarqueId                 BigInt
  respProduccionId               BigInt
  respAlmacenId                  BigInt
  incotermsId                    BigInt
  idPaisDestino                  BigInt
  pesoMaximoContenedor           Decimal?
  fechaZarpe                     DateTime?
  fechaArribo                    DateTime?
  agenteAduanasId                BigInt?
  operadorLogisticoId            BigInt?
  prefacturaVentaId              BigInt?
  supervisorVentaCampoId         BigInt?
  observaciones                  String?
  creadoEn                       DateTime                 @default(now())
  actualizadoEn                  DateTime
  centroCostoId                  BigInt
  estadoCotizacionId             BigInt
  puertoCargaId                  BigInt?
  puertoDescargaId               BigInt?
  monedaClienteId                BigInt?
  montoAdelantadoCliente         Decimal?
  fechaUsuarioGeneroPreFactVenta DateTime?
  fechaUsuarioGeneroReqCompraId  DateTime?
  reqCompraId                    BigInt?
  usuarioGeneroPreFactVentaId    BigInt?
  usuarioGeneroReqCompraId       BigInt?
  destinoProductoId              BigInt
  formaTransaccionId             BigInt
  modoDespachoRecepcionId        BigInt
  tipoEstadoProductoId           BigInt
  dirEntregaId                   BigInt
  dirFiscalId                    BigInt

// Relaciones
  tipoProducto              TipoProducto   @relation(fields: [tipoProductoId], references: [id])
  tipoEstadoProducto        TipoEstadoProducto      @relation(fields: [tipoEstadoProductoId], references: [id])
  destinoProducto           DestinoProducto   @relation(fields: [destinoProductoId], references: [id])
  formaTransaccion          FormaTransaccion     @relation(fields: [formaTransaccionId], references: [id])
  modoDespachoRecepcion     ModoDespachoRecepcion   @relation(fields: [modoDespachoRecepcionId], references: [id])

  detalles                  DetCotizacionVentas[]
  detDocsReqCotizaVentas detDocsReqCotizaVentas[]
  entregasARendirPVentas    EntregaARendirPVentas[]
}

model CuentaCorriente {
  id                                                                      BigInt              @id @default(autoincrement())
  empresaId                                                               BigInt
  bancoId                                                                 BigInt
  numeroCuenta                                                            String
  tipoCuentaCorrienteId                                                   BigInt
  monedaId                                                                BigInt
  descripcion                                                             String?
  activa                                                                  Boolean             @default(true)
  codigoSwift                                                             String?
  numeroCuentaCCI                                                         String?

  banco                  Banco    @relation(fields: [bancoId], references: [id])
  tipoCuentaCorriente    TipoCuentaCorriente @relation(fields: [tipoCuentaCorrienteId], references: [id])
  moneda                 Moneda   @relation(fields: [monedaId], references: [id])
  movimientosOrigen      MovimientoCaja[] @relation("CuentaCorrienteOrigen")
  movimientosDestino     MovimientoCaja[] @relation("CuentaCorrienteDestino")

    @@unique([numeroCuenta, bancoId, empresaId], name: "unique_cuenta_banco_empresa")

}

model Departamento {
  id        BigInt      @id @default(autoincrement())
  codSUNAT  String      @unique
  nombre    String
  paisId    BigInt

  pais       Pais     @relation(fields: [paisId], references: [id])
  provincias Provincia[]
  ubigeos    Ubigeo[]
}

model DescargaFaenaConsumo {
  id                           BigInt                    @id @default(autoincrement())
  faenaPescaConsumoId          BigInt                    @unique
  puertoDescargaId             BigInt?
  fechaHoraArriboPuerto        DateTime?
  fechaHoraLlegadaPuerto       DateTime?
  clienteId                    BigInt?
  numPlataformaDescarga        String?                   @db.VarChar(20)
  turnoPlataformaDescarga      String?                   @db.VarChar(20)
  fechaHoraInicioDescarga      DateTime?
  fechaHoraFinDescarga         DateTime?
  numWinchaPesaje              String?                   @db.VarChar(20)
  urlComprobanteWincha         String?
  patronId                      BigInt
  motoristaId                  BigInt
  bahiaId                      BigInt
  latitud                      Decimal?
  longitud                     Decimal?
  combustibleAbastecidoGalones Decimal?
  urlValeAbastecimiento        String?
  urlInformeDescargaProduce    String?
  observaciones                String?
  creadoEn                     DateTime                  @default(now())
  actualizadoEn                DateTime
  movIngresoAlmacenId          BigInt?
  especieId              BigInt?
  toneladas              Decimal?
  porcentajeJuveniles    Decimal?
  fechaHoraFondeo     DateTime?
  latitudFondeo       Decimal?
  longitudFondeo      Decimal?
  puertoFondeoId      BigInt?

  faenaPescaConsumo            FaenaPescaConsumo @relation(fields: [faenaPescaConsumoId], references: [id])

  @@index([movIngresoAlmacenId])
}



model DescargaFaenaPesca {
  id                           BigInt                 @id @default(autoincrement())
  faenaPescaId                 BigInt                 @unique
  puertoDescargaId             BigInt?
  fechaHoraArriboPuerto        DateTime?
  fechaHoraLlegadaPuerto       DateTime?
  numPlataformaDescarga        String?                @db.VarChar(20)
  turnoPlataformaDescarga      String?                @db.VarChar(20)
  fechaHoraInicioDescarga      DateTime?
  fechaHoraFinDescarga         DateTime?
  numWinchaPesaje              String?                @db.VarChar(20)
  urlComprobanteWincha         String?
  patronId                      BigInt
  motoristaId                  BigInt
  bahiaId                      BigInt
  latitud                      Decimal?
  longitud                     Decimal?
  combustibleAbastecidoGalones Decimal?
  urlValeAbastecimiento        String?
  observaciones                String?
  creadoEn                     DateTime               @default(now())
  actualizadoEn                DateTime
  clienteId                    BigInt?
  temporadaPescaId             BigInt
  urlInformeDescargaProduce    String?
  movIngresoAlmacenId          BigInt?
  especieId           BigInt?
  toneladas           Decimal?
  porcentajeJuveniles Decimal?
  numReporteRecepcion String? @db.VarChar(20)
  fechaHoraFondeo     DateTime?
  latitudFondeo       Decimal?
  longitudFondeo      Decimal?
  puertoFondeoId      BigInt?

faenaPesca FaenaPesca @relation(fields: [faenaPescaId], references: [id])

  @@index([movIngresoAlmacenId])
}


model DetAccionesPreviasFaena {
  id                   BigInt               @id @default(autoincrement())
  faenaPescaId         BigInt
  accionPreviaId       BigInt
  responsableId        BigInt?
  verificadorId        BigInt?
  fechaVerificacion    DateTime?
  cumplida             Boolean              @default(false)
  fechaCumplida        DateTime?
  observaciones        String?
  verificado           Boolean              @default(false)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  urlConfirmaAccionPdf String?

  faenaPesca        FaenaPesca @relation(fields: [faenaPescaId], references: [id])
  accionPrevia      AccionesPreviasFaena @relation(fields: [accionPreviaId], references: [id])
}

model DetAccionesPreviasFaenaConsumo {
  id                   BigInt               @id @default(autoincrement())
  faenaPescaConsumoId  BigInt
  accionPreviaId       BigInt
  responsableId        BigInt?
  verificadorId        BigInt?
  fechaVerificacion    DateTime?
  cumplida             Boolean              @default(false)
  fechaCumplida        DateTime?
  urlConfirmaAccionPdf String?
  observaciones        String?
  verificado           Boolean              @default(false)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime

  faenaPescaConsumo    FaenaPescaConsumo     @relation(fields: [faenaPescaConsumoId], references: [id])
  accionPrevia         AccionesPreviasFaena  @relation(fields: [accionPreviaId], references: [id])
}

model DetCalaPescaConsumo {
  id                  BigInt           @id @default(autoincrement())
  calaFaenaConsumoId  BigInt
  especieId           BigInt
  toneladas           Decimal?
  porcentajeJuveniles Decimal?
  observaciones       String?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime

  calaFaenaConsumo    CalaFaenaConsumo @relation(fields: [calaFaenaConsumoId], references: [id])
  especie             Especie @relation(fields: [especieId], references: [id])
}

model DetCotizacionVentas {
  id                 BigInt           @id @default(autoincrement())
  empresaId          BigInt
  cotizacionVentasId BigInt
  productoId         BigInt
  clienteId          BigInt
  cantidad           Decimal
  precioUnitario     Decimal
  monedaId           BigInt
  movSalidaAlmacenId BigInt
  prefacturaVentaId  BigInt?
  observaciones      String?
  creadoEn           DateTime         @default(now())
  actualizadoEn      DateTime
  centroCostoId      BigInt

  cotizacionVentas    CotizacionVentas @relation(fields: [cotizacionVentasId], references: [id])
  producto            Producto         @relation(fields: [productoId], references: [id])
}



model DetDocEmbarcacionPescaConsumo {
  id                  BigInt            @id @default(autoincrement())
  faenaPescaConsumoId BigInt
  documentoPescaId    BigInt
  numeroDocumento     String?
  fechaEmision        DateTime?
  fechaVencimiento    DateTime?
  urlDocEmbarcacion    String?
  observaciones       String?
  verificado          Boolean
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  docVencido  Boolean @default(false)

  faenaPescaConsumo FaenaPescaConsumo @relation(fields: [faenaPescaConsumoId], references: [id])
}

model DetDocTripulantesFaenaConsumo {
  id                  BigInt            @id @default(autoincrement())
  faenaPescaConsumoId BigInt
  tripulanteId        BigInt?
  documentoId         BigInt?
  numeroDocumento     String?
  fechaEmision        DateTime?
  fechaVencimiento    DateTime?
  urlDocTripulantePdf String?
  observaciones       String?
  verificado          Boolean
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  docVencido          Boolean             @default(false)

  faenaPescaConsumo    FaenaPescaConsumo @relation(fields: [faenaPescaConsumoId], references: [id])
}

model DetInsumosTareaOT {
  id                  BigInt      @id @default(autoincrement())
  tareaId             BigInt
  productoId          BigInt
  cantidad            Decimal?
  costoUnitario       Decimal?
  observaciones       String?
  aprobacionComprasId BigInt?
  actualizadoEn       DateTime
  proveedorId         BigInt?

  tarea              DetTareasOT  @relation(fields: [tareaId], references: [id])
  producto           Producto     @relation(fields: [productoId], references: [id])
}

model DetMovsEntRendirPescaConsumo {
  id                           BigInt                     @id @default(autoincrement())
  entregaARendirPescaConsumoId BigInt
  responsableId                BigInt
  fechaMovimiento              DateTime
  tipoMovimientoId             BigInt
  centroCostoId                BigInt
  monto                        Decimal
  descripcion                  String?
  creadoEn                     DateTime                   @default(now())
  actualizadoEn                DateTime
  urlComprobanteMovimiento String?
  validadoTesoreria    Boolean @default(false)
  fechaValidacionTesoreria DateTime?
  operacionSinFactura  Boolean @default(false)
  fechaOperacionMovCaja DateTime?
  operacionMovCajaId BigInt?
  moduloOrigenMovCajaId BigInt?
  entidadComercialId BigInt?
  monedaId BigInt?
  urlComprobanteOperacionMovCaja String?

  tipoDocumentoId        BigInt?                                     // Factura, Boleta, Recibo, Ticket, Sin Comprobante
  numeroSerieComprobante        String?                              // Número Serie del comprobante
  numeroCorrelativoComprobante String?                               // Número Correlativo del comprobante

  entregaARendirPescaConsumo EntregaARendirPescaConsumo @relation(fields: [entregaARendirPescaConsumoId], references: [id])
  tipoMovimiento        TipoMovEntregaRendir @relation(fields: [tipoMovimientoId], references: [id])
  entidadComercial EntidadComercial? @relation(fields: [entidadComercialId], references: [id])
  moneda Moneda? @relation(fields: [monedaId], references: [id])
  tipoDocumento TipoDocumento? @relation(fields: [tipoDocumentoId], references: [id])
}

model DetMovsEntregaRendir {
  id                   BigInt               @id @default(autoincrement())
  entregaARendirId     BigInt
  responsableId        BigInt
  fechaMovimiento      DateTime
  tipoMovimientoId     BigInt
  monto                Decimal
  descripcion          String?
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime
  centroCostoId        BigInt
  urlComprobanteMovimiento String?
  validadoTesoreria    Boolean @default(false)
  fechaValidacionTesoreria DateTime?
  operacionSinFactura  Boolean @default(false)
  fechaOperacionMovCaja DateTime?
  operacionMovCajaId BigInt?
  moduloOrigenMovCajaId BigInt?
  entidadComercialId BigInt?
  monedaId BigInt?
  urlComprobanteOperacionMovCaja String?

  tipoDocumentoId        BigInt?                                     // Factura, Boleta, Recibo, Ticket, Sin Comprobante
  numeroSerieComprobante        String?                              // Número Serie del comprobante
  numeroCorrelativoComprobante String?                               // Número Correlativo del comprobante

  entregaARendir        EntregaARendir @relation(fields: [entregaARendirId], references: [id])
  tipoMovimiento        TipoMovEntregaRendir @relation(fields: [tipoMovimientoId], references: [id])
  entidadComercial EntidadComercial? @relation(fields: [entidadComercialId], references: [id])
  moneda Moneda? @relation(fields: [monedaId], references: [id])
  tipoDocumento TipoDocumento? @relation(fields: [tipoDocumentoId], references: [id])

}

model DetMovsEntregaRendirPCompras {
  id                       BigInt      @id @default(autoincrement())
  entregaARendirPComprasId BigInt                                      // Entrega a rendir a la que pertenece
  tipoMovimientoId         BigInt                                      // 1=Entrega Inicial, 2=Gasto, 3=Devolución, 4=Ampliación
  responsableId            BigInt                                      // Personal que realizó el movimiento
  fechaMovimiento          DateTime                                    // Fecha del movimiento
  monto                    Decimal                                     // Monto del movimiento (positivo o negativo según tipo)
  monedaId                 BigInt?                                     // Moneda del movimiento (PEN, USD)
  descripcion              String?     @db.Text                        // Descripción detallada del movimiento
  entidadComercialId       BigInt?                                     // Proveedor o tercero al que se le pagó
  
  tipoDocumentoId        BigInt?                                     // Factura, Boleta, Recibo, Ticket, Sin Comprobante
  numeroSerieComprobante        String?                              // Número Serie del comprobante
  numeroCorrelativoComprobante String?                               // Número Correlativo del comprobante

  urlComprobanteMovimiento String?                                     // URL del comprobante escaneado/fotografiado
  validadoTesoreria        Boolean     @default(false)                 // Si tesorería validó el movimiento
  fechaValidacionTesoreria DateTime?                                   // Cuándo se validó
  operacionSinFactura      Boolean     @default(false)                 // Si no hay comprobante formal
  motivoSinFactura         String?     @db.Text                        // Por qué no hay comprobante (compra informal, etc.)
  operacionMovCajaId       BigInt?                                     // Si se registró en movimiento de caja
  fechaOperacionMovCaja    DateTime?                                   // Fecha del movimiento de caja
  urlComprobanteOperacionMovCaja String?                               // Comprobante del movimiento de caja
  moduloOrigenMovCajaId    BigInt?                                     // Módulo que originó el movimiento (Compras, Ventas, etc.)
  centroCostoId            BigInt                                      // Centro de costo del movimiento
  creadoEn                 DateTime    @default(now())
  actualizadoEn            DateTime    @updatedAt
  
  entregaARendirPCompras   EntregaARendirPCompras @relation(fields: [entregaARendirPComprasId], references: [id], onDelete: Cascade)
  tipoMovimiento           TipoMovEntregaRendir @relation(fields: [tipoMovimientoId], references: [id])
  entidadComercial         EntidadComercial? @relation(fields: [entidadComercialId], references: [id])
  moneda Moneda? @relation(fields: [monedaId], references: [id])
  tipoDocumento TipoDocumento? @relation(fields: [tipoDocumentoId], references: [id])
}

model DetMovsEntregaRendirPVentas {
  id                      BigInt                @id @default(autoincrement())
  entregaARendirPVentasId BigInt
  responsableId           BigInt
  fechaMovimiento         DateTime
  tipoMovimientoId        BigInt
  monto                   Decimal
  monedaId BigInt?
  descripcion             String?
  entidadComercialId BigInt?

  tipoDocumentoId        BigInt?                                     // Factura, Boleta, Recibo, Ticket, Sin Comprobante
  numeroSerieComprobante        String?                              // Número Serie del comprobante
  numeroCorrelativoComprobante String?                               // Número Correlativo del comprobante


  urlComprobanteMovimiento String?
  validadoTesoreria    Boolean @default(false)
  fechaValidacionTesoreria DateTime?
  operacionSinFactura  Boolean @default(false)
  fechaOperacionMovCaja DateTime?
  urlComprobanteOperacionMovCaja String?
  moduloOrigenMovCajaId BigInt?
  centroCostoId           BigInt
  creadoEn                DateTime              @default(now())
  actualizadoEn           DateTime
  operacionMovCajaId BigInt?

  entregaARendirPVentas    EntregaARendirPVentas @relation(fields: [entregaARendirPVentasId], references: [id])
  tipoMovimiento           TipoMovEntregaRendir  @relation(fields: [tipoMovimientoId], references: [id])
  entidadComercial EntidadComercial? @relation(fields: [entidadComercialId], references: [id])
  moneda Moneda? @relation(fields: [monedaId], references: [id])
  tipoDocumento TipoDocumento? @relation(fields: [tipoDocumentoId], references: [id])
}

model DetPermisoGestionadoOT {
  id                BigInt          @id @default(autoincrement())
  otMantenimientoId BigInt
  permisoId         BigInt
  gestionado        Boolean         @default(false)
  fechaGestion      DateTime?
  observaciones     String?

  otMantenimiento   OTMantenimiento     @relation(fields: [otMantenimientoId], references: [id])
}


model DetTareasOT {
  id                      BigInt              @id @default(autoincrement())
  otMantenimientoId       BigInt
  descripcion             String
  responsableId           BigInt?
  fechaProgramada         DateTime?
  fechaInicio             DateTime?
  fechaFin                DateTime?
  realizado               Boolean             @default(false)
  observaciones           String?
  urlFotosAntesPdf        String?
  adjuntoCotizacionUno    Boolean             @default(false)
  urlCotizacionUnoPdf     String?
  adjuntoCotizacionDos    Boolean             @default(false)
  urlCotizacionDosPdf     String?
  actualizadoEn           DateTime
  fechaValidaTerminoTarea DateTime?
  validaTerminoTareaId    BigInt?

  otMantenimiento   OTMantenimiento @relation(fields: [otMantenimientoId], references: [id])
  insumos DetInsumosTareaOT[]
}

model DetalleCalaEspecie {
  id                  BigInt   @id @default(autoincrement())
  calaId              BigInt
  especieId           BigInt
  toneladas           Decimal?
  porcentajeJuveniles Decimal?
  observaciones       String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  cala                Cala   @relation(fields: [calaId], references: [id])
  especie             Especie @relation(fields: [especieId], references: [id])
}



model Especie {
  id BigInt @id @default(autoincrement())
  nombre String @db.VarChar(100)
  nombreCientifico String @db.VarChar(100)

  calaEspecie DetalleCalaEspecie[]
  calaFaenaConsumo DetCalaPescaConsumo[]
}




model DetalleDocEmbarcacion {
  id               BigInt     @id @default(autoincrement())
  faenaPescaId     BigInt
  documentoPescaId BigInt
  numeroDocumento  String?
  fechaEmision     DateTime?
  fechaVencimiento DateTime?
  observaciones    String?
  verificado       Boolean
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  urlDocEmbarcacion String?
  docVencido  Boolean @default(false)

  faenaPesca       FaenaPesca     @relation(fields: [faenaPescaId], references: [id])
}

model DetalleDocTripulantes {
  id                  BigInt     @id @default(autoincrement())
  faenaPescaId        BigInt
  tripulanteId        BigInt?
  documentoId         BigInt?
  numeroDocumento     String?
  fechaEmision        DateTime?
  fechaVencimiento    DateTime?
  observaciones       String?
  verificado          Boolean
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  urlDocTripulantePdf String?
  docVencido Boolean @default(false)

  faenaPesca     FaenaPesca @relation(fields: [faenaPescaId], references: [id])
}

model DetalleMovimientoAlmacen {
  id                  BigInt            @id @default(autoincrement())
  movimientoAlmacenId BigInt
  productoId          BigInt
  cantidad            Decimal
  peso            Decimal?
  lote                String?           @db.VarChar(40)
  fechaProduccion     DateTime?
  fechaVencimiento    DateTime?
  fechaIngreso        DateTime?
  nroSerie            String?           @db.VarChar(40)
  nroContenedor       String?           @db.VarChar(40)
  estadoMercaderiaId  BigInt?
  estadoCalidadId     BigInt?
  entidadComercialId  BigInt?
  esCustodia          Boolean           @default(false)
  empresaId           BigInt
  observaciones       String?
  creadoEn            DateTime          @default(now())
  actualizadoEn       DateTime
  creadoPor           BigInt?
  actualizadoPor      BigInt?
  detalleReqCompraId  BigInt?
  costoUnitario       Decimal?

  movimientoAlmacen     MovimientoAlmacen  @relation(fields: [movimientoAlmacenId], references: [id])
  producto              Producto @relation(fields: [productoId], references: [id])
  detalleReqCompra      DetalleReqCompra? @relation(fields: [detalleReqCompraId], references: [id])
}

model DetalleOrdenCompra {
  id             BigInt      @id @default(autoincrement())
  ordenCompraId  BigInt                                         // Orden a la que pertenece
  productoId     BigInt                                         // Producto a comprar
  cantidad       Decimal                                        // Cantidad ordenada
  cantidadRecibida Decimal?  @default(0)                        // Cantidad realmente recibida
  precioUnitario Decimal                                        // Precio por unidad
  centroCostoId  BigInt?                                        // Centro de costo específico
  observaciones  String?     @db.Text                           // Notas del item
  creadoEn       DateTime    @default(now())
  actualizadoEn  DateTime    @updatedAt
  
  ordenCompra    OrdenCompra @relation(fields: [ordenCompraId], references: [id], onDelete: Cascade)
  producto       Producto @relation(fields: [productoId], references: [id])
  
  @@index([ordenCompraId])
  @@index([productoId])
}

model DetallePreFactura {
  id             BigInt     @id @default(autoincrement())
  preFacturaId   BigInt
  productoId     BigInt
  cantidad       Decimal
  precioUnitario Decimal?
  subtotal       Decimal?
  porcentajeIgv  Decimal?
  igv            Decimal?
  total          Decimal?
  observaciones  String?
  actualizadoEn  DateTime
  centroCostoId  BigInt?

  preFactura       PreFactura @relation(fields: [preFacturaId], references: [id])
  producto Producto @relation(fields: [productoId], references: [id])
}

model RequerimientoCompra {
  id                    BigInt      @id @default(autoincrement())
  empresaId             BigInt                                  // Empresa que solicita la compra
  tipoDocumentoId       BigInt                                  // Tipo de documento (Se asigna el ID 16("REQUERIMIENTO COMPRAS"))
  serieDocId               BigInt?
  numSerieDoc              String?                    @db.VarChar(40)
  numCorreDoc              String?                    @db.VarChar(40)
  numeroDocumento          String?
  fechaDocumento           DateTime @default(now())
  esConCotizacion       Boolean     @default(false)             // false=Compra Directa, true=Con Cotización
  tipoProductoId        BigInt                                  // Hidrobiológico, Agroindustria, Insumos, etc.
  tipoEstadoProductoId  BigInt                                  // Fresco, Congelado, Conserva, etc.
  destinoProductoId     BigInt                                  // Mercado Local, Exterior
  proveedorId           BigInt?                                 // Proveedor único (Compra Directa) o NULL (Múltiples proveedores)
  formaPagoId           BigInt?                                 // Contado, Crédito 30 días, etc.
  modoDespachoRecepcionId BigInt?                               // Entrega en almacén, puerto, etc.
  monedaId              BigInt?                                 // PEN, USD, EUR
  tipoCambio            Decimal?                                // Tipo de cambio del día
  ordenTrabajoId        BigInt?                                 // Si está vinculado a una OT específica
  fechaRequerida        DateTime?                               // Fecha en que se necesita el producto
  fechaAprobacion       DateTime?                               // Cuándo fue aprobado
  solicitanteId         BigInt?                                 // Usuario que solicita la compra
  respComprasId         BigInt?                                 // Responsable del área de compras
  respProduccionId      BigInt?                                 // Responsable de producción (si aplica)
  respAlmacenId         BigInt?                                 // Responsable del almacén receptor
  supervisorCampoId     BigInt?                                 // Supervisor en campo/puerto
  aprobadoPorId         BigInt?                                 // Usuario que aprobó el requerimiento
  autorizaCompraId      BigInt?                                 // Usuario que autoriza la compra
  estadoId              BigInt                                  // Estado desde EstadosMultifuncion
  centroCostoId         BigInt?                                 // Centro de costo que asume el gasto
  urlReqCompraPdf       String?                                 // URL del PDF generado
  creadoEn              DateTime    @default(now())             // Fecha de creación del registro
  actualizadoEn         DateTime    @updatedAt                  // Última actualización
  creadoPor             BigInt?                                 // Usuario que creó el registro
  actualizadoPor        BigInt?                                 // Usuario que actualizó por última vez
  porcentajeIGV         Decimal?                                // Porcentaje de IGV
  esExoneradoAlIGV      Boolean?   @default(false)             // Es exonerado al IGV
  
  tipoProducto          TipoProducto @relation(fields: [tipoProductoId], references: [id])
  tipoEstadoProducto    TipoEstadoProducto @relation(fields: [tipoEstadoProductoId], references: [id])
  destinoProducto       DestinoProducto @relation(fields: [destinoProductoId], references: [id])
  proveedor             EntidadComercial? @relation("ProveedorRequerimiento", fields: [proveedorId], references: [id])
  formaPago             FormaPago? @relation(fields: [formaPagoId], references: [id])
  modoDespachoRecepcion ModoDespachoRecepcion? @relation(fields: [modoDespachoRecepcionId], references: [id])
  tipoDocumento         TipoDocumento @relation(fields: [tipoDocumentoId], references: [id])
  serieDoc              SerieDoc? @relation(fields: [serieDocId], references: [id])
  empresa               Empresa @relation(fields: [empresaId], references: [id])
  
  cotizacionesProveedores CotizacionProveedor[]                 // Cotizaciones recibidas (si aplica)
  detalles              DetalleReqCompra[]                      // Items del requerimiento
  ordenesCompra         OrdenCompra[]                           // Órdenes de compra generadas
  entregaARendir        EntregaARendirPCompras?                 // Entrega a rendir asociada (relación 1:1)
  
  @@index([empresaId, fechaDocumento])
  @@index([estadoId])
  @@index([proveedorId])
}


model DetalleReqCompra {
  id                       BigInt      @id @default(autoincrement())
  requerimientoCompraId    BigInt                                // Requerimiento al que pertenece
  productoId               BigInt                                // Producto solicitado
  proveedorId              BigInt?                               // Proveedor específico del item (CAMPO CLAVE para generar OC)
  cantidad         Decimal                              // Cantidad que se debe comprar (solicitada - almacen)
  costoUnitario            Decimal?                             // Precio unitario negociado/cotizado
  subtotal                 Decimal?                             // cantidadAComprar * costoUnitario
  monedaId                 BigInt?                              // Moneda del precio (puede diferir de la cabecera)
  cotizacionProveedorId    BigInt?                              // Si viene de una cotización seleccionada
  centroCostoId            BigInt?                              // Centro de costo específico del item
  observaciones            String?     @db.Text                 // Notas específicas del item
  ordenCompraDetalleId     BigInt?                              // ID del detalle de OC generado
  creadoEn                 DateTime    @default(now())
  actualizadoEn            DateTime    @updatedAt
  
  requerimientoCompra      RequerimientoCompra @relation(fields: [requerimientoCompraId], references: [id], onDelete: Cascade)
  producto                 Producto @relation(fields: [productoId], references: [id])
  proveedor                EntidadComercial? @relation("ProveedorDetalleReq", fields: [proveedorId], references: [id])
  cotizacionProveedor      CotizacionProveedor? @relation(fields: [cotizacionProveedorId], references: [id])
  detalleMovimientos       DetalleMovimientoAlmacen[]           // Movimientos de almacén que atendieron este item
  
  @@index([requerimientoCompraId])
  @@index([productoId])
  @@index([proveedorId])
}

// ============================================================================
// COTIZACIÓN DE PROVEEDOR
// Registro de cotizaciones recibidas de diferentes proveedores
// Permite comparar precios y condiciones antes de aprobar el requerimiento
// Solo se usa cuando esConCotizacion = true
// ============================================================================
model CotizacionProveedor {
  id                    BigInt      @id @default(autoincrement())
  requerimientoCompraId BigInt                                  // Requerimiento al que pertenece
  proveedorId           BigInt                                  // Proveedor que presenta la cotización
  productoId            BigInt                                  // Producto cotizado
  cantidad              Decimal                                 // Cantidad ofrecida
  precioUnitario        Decimal                                 // Precio por unidad
  monedaId              BigInt                                  // Moneda de la cotización
  tiempoEntregaDias     Int?                                    // Días para entregar desde la orden
  lugarEntrega          String?                                 // Dónde entrega (puerto, almacén, etc.)
  seleccionado          Boolean     @default(false)             // Si fue elegida esta cotización
  motivoSeleccion       String?     @db.Text                    // Por qué se eligió o rechazó
  fechaSeleccion        DateTime?                               // Cuándo se seleccionó
  seleccionadoPor       BigInt?                                 // Usuario que seleccionó
  urlCotizacionPdf      String?                                 // PDF de la cotización del proveedor
  fechaCotizacion       DateTime    @default(now())             // Fecha de la cotización
  creadoEn              DateTime    @default(now())
  creadoPor             BigInt?
  actualizadoEn         DateTime    @updatedAt
  
  requerimientoCompra   RequerimientoCompra @relation(fields: [requerimientoCompraId], references: [id], onDelete: Cascade)
  proveedor             EntidadComercial @relation("CotizacionProveedor", fields: [proveedorId], references: [id])
  producto              Producto @relation(fields: [productoId], references: [id])
  detallesReqGenerados  DetalleReqCompra[]                      // Detalles de req que se generaron desde esta cotización
  
  @@index([requerimientoCompraId])
  @@index([proveedorId])
  @@index([seleccionado])
}


model DireccionEntidad {
  id                 BigInt           @id @default(autoincrement())
  entidadComercialId BigInt
  direccion          String
  direccionArmada    String?
  ubigeoId           BigInt
  fiscal             Boolean          @default(false)
  almacenPrincipal   Boolean          @default(false)
  referencia         String?
  telefono           String?
  correo             String?
  activo             Boolean          @default(true)

  entidadComercial   EntidadComercial @relation(fields: [entidadComercialId], references: [id])
  ubigeo             Ubigeo           @relation(fields: [ubigeoId], references: [id])
}

model DocRequeridaComprasVentas {
  id                      BigInt                    @id @default(autoincrement())
  nombre                  String                    @unique
  descripcion             String?
  obligatorio             Boolean                   @default(true)
  activo                  Boolean                   @default(true)
  tipoProductoId          BigInt
  tipoEstadoProductoId    BigInt
  destinoProductoId       BigInt
  formaTransaccionId      BigInt
  paraCompras             Boolean                   @default(false)
  paraVentas              Boolean                   @default(false)

  detallesDocCotizacion detDocsReqCotizaVentas[]
}

model DocumentacionEmbarcacion {
  id               BigInt         @id @default(autoincrement())
  embarcacionId    BigInt
  documentoPescaId BigInt
  numeroDocumento  String?
  fechaEmision     DateTime?
  fechaVencimiento DateTime?
  urlDocPdf String?
  docVencido Boolean @default(false)
  observaciones    String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  cesado Boolean @default(false)

  embarcacion     Embarcacion   @relation(fields: [embarcacionId], references: [id])
}

model DocumentacionPersonal {
  id               BigInt         @id @default(autoincrement())
  personalId       BigInt
  documentoPescaId BigInt
  numeroDocumento  String?
  fechaEmision     DateTime?
  fechaVencimiento DateTime?
  urlDocPdf String?
  docVencido Boolean @default(false)
  observaciones    String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  cesado Boolean @default(false)

  personal        Personal        @relation(fields: [personalId], references: [id])
}

model DocumentoPesca {
  id                       BigInt                     @id @default(autoincrement())
  nombre                   String
  descripcion              String?
  obligatorio              Boolean
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  cesado                   Boolean                    @default(false)
  paraEmbarcacion          Boolean                    @default(false)
  paraOperacionFaena       Boolean                    @default(false)
  paraTripulantes          Boolean                    @default(false)

}

model Embarcacion {
  id                                     BigInt                     @id @default(autoincrement())
  matricula                              String                     @unique
  capacidadBodegaTon                     Decimal?
  esloraM                                Decimal?
  mangaM                                 Decimal?
  puntalM                                Decimal?
  motorMarca                             String?
  motorPotenciaHp                        Int?
  anioFabricacion                        Int?
  proveedorGpsId                         BigInt?
  tabletMarca                            String?
  tabletModelo                           String?
  fechaCreacion                          DateTime                   @default(now())
  fechaActualizacion                     DateTime
  activoId                               BigInt                     @unique
  tipoEmbarcacionId                      BigInt
  estadoActivoId                         BigInt
  urlFotoEmbarcacion                     String?

  tipoEmbarcacion   TipoEmbarcacion @relation(fields: [tipoEmbarcacionId], references: [id])
  documentaciones DocumentacionEmbarcacion[]
  faenas FaenaPesca[] @relation("EmbarcacionFaenas")
  faenasConsumo FaenaPescaConsumo[] @relation("EmbarcacionFaenasConsumo")
  activo            Activo          @relation(fields: [activoId], references: [id])
}

model Empresa {
  id                   BigInt               @id @default(autoincrement())
  razonSocial          String
  nombreComercial      String?
  ruc                  String
  direccion            String?
  telefono             String?
  email                String?
  fechaCreacion        DateTime             @default(now())
  fechaActualizacion   DateTime
  logo                 String?
  porcentajeIgv        Decimal?
  cesado               Boolean              @default(false)
  representantelegalId BigInt?
  cuentaDetraccion     String?
  montoMinimoRetencion Decimal?
  porcentajeRetencion  Decimal?
  soyAgentePercepcion  Boolean              @default(false)
  soyAgenteRetencion   Boolean              @default(false)
  entidadComercialId   BigInt?

  sedes SedesEmpresa[]
  centrosCosto EmpresaCentroCosto[]
  movimientosAlmacen MovimientoAlmacen[]
  ordenesCompra OrdenCompra[]
  requerimientosCompra RequerimientoCompra[]
}

model EmpresaCentroCosto {
  EmpresaID          BigInt
  CentroCostoID      BigInt
  ResponsableID      BigInt
  ProveedorExternoID BigInt?
  Activo             Boolean     @default(true)
  id                 BigInt      @id @default(autoincrement())

  empresa      Empresa     @relation(fields: [EmpresaID], references: [id])
  centroCosto  CentroCosto @relation(fields: [CentroCostoID], references: [id])
}

model EntidadComercial {
  id                   BigInt                @id @default(autoincrement())
  empresaId            BigInt
  tipoDocumentoId      BigInt
  tipoEntidadId        BigInt
  formaPagoId          BigInt
  vendedorId           BigInt?
  agenciaEnvioId       BigInt?
  agrupacionEntidadId  BigInt?
  numeroDocumento      String                @db.VarChar(20)
  razonSocial          String                @db.VarChar(255)
  nombreComercial      String?               @db.VarChar(255)
  esCliente            Boolean               @default(false)
  esProveedor          Boolean               @default(false)
  esCorporativo        Boolean               @default(false)
  estado               Boolean               @default(true)
  observaciones        String?
  codigoErpFinanciero  String?               @db.VarChar(50)
  custodiaStock        Boolean               @default(false)
  controlLote          Boolean               @default(false)
  controlFechaVenc     Boolean               @default(false)
  controlFechaProd     Boolean               @default(false)
  controlFechaIngreso  Boolean               @default(false)
  controlSerie         Boolean               @default(false)
  controlEnvase        Boolean               @default(false)
  sujetoRetencion      Boolean               @default(false)
  sujetoPercepcion     Boolean               @default(false)
  creadoEn             DateTime              @default(now())
  actualizadoEn        DateTime
  creadoPor            BigInt?
  actualizadoPor       BigInt?
  condicionHabidoSUNAT Boolean               @default(true)
  estadoActivoSUNAT    Boolean               @default(true)
  esAgenteRetencion    Boolean               @default(false)

  tipoDocumento        TiposDocIdentidad   @relation(fields: [tipoDocumentoId], references: [id])
  tipoEntidad          TipoEntidad         @relation(fields: [tipoEntidadId], references: [id])
  formaPago            FormaPago           @relation(fields: [formaPagoId], references: [id])
  agrupacionEntidad    AgrupacionEntidad?  @relation(fields: [agrupacionEntidadId], references: [id])
  contactos            ContactoEntidad[]
  direcciones          DireccionEntidad[]
  precios              PrecioEntidad[]
  vehiculos            VehiculoEntidad[]
  lineasCredito        LineaCreditoEntidad[]

  movimientosAlmacen MovimientoAlmacen[]
  kardexAlmacenes   KardexAlmacen[]
  requerimientosCompra RequerimientoCompra[] @relation("ProveedorRequerimiento")
  detallesReqCompra DetalleReqCompra[] @relation("ProveedorDetalleReq")
  cotizacionesProveedores CotizacionProveedor[] @relation("CotizacionProveedor")
  ordenesCompra OrdenCompra[] @relation("ProveedorOrdenCompra")
  movimientosCaja MovimientoCaja[]
  detalleMovsEntregaRendir DetMovsEntregaRendir[]
  detalleMovsEntregaRendirPescaConsumo DetMovsEntRendirPescaConsumo[]
  detalleMovsEntregaRendirPCompras DetMovsEntregaRendirPCompras[]
  detalleMovsEntregaRendirPVentas DetMovsEntregaRendirPVentas[]
  preFacturasCliente PreFactura[] @relation("EntidadComercialToPreFactura")
  saldosDetProductoCliente SaldosDetProductoCliente[]
  saldosProductoCliente SaldosProductoCliente[]
}

model EntregaARendir {
  id                   BigInt                 @id @default(autoincrement())
  temporadaPescaId     BigInt
  entregaLiquidada     Boolean                @default(false)
  fechaLiquidacion     DateTime?
  fechaCreacion        DateTime               @default(now())
  fechaActualizacion   DateTime
  respEntregaRendirId  BigInt
  centroCostoId        BigInt
  
  temporadaPesca        TemporadaPesca @relation(fields: [temporadaPescaId], references: [id])
  movimientos           DetMovsEntregaRendir[]
}

model EntregaARendirPCompras {
  id                           BigInt      @id @default(autoincrement())
  requerimientoCompraId        BigInt      @unique                     // Requerimiento que origina las entregas (relación 1:1)
  respEntregaRendirId          BigInt                                  // Personal responsable de rendir cuentas
  entregaLiquidada             Boolean     @default(false)             // Si ya se cerró y liquidó todo
  fechaLiquidacion             DateTime?                               // Cuándo se liquidó
  centroCostoId                BigInt                                  // Centro de costo que asume los gastos
  fechaCreacion                DateTime    @default(now())
  fechaActualizacion           DateTime    @updatedAt
  creadoPor                    BigInt?
  actualizadoPor               BigInt?
  
  requerimientoCompra          RequerimientoCompra @relation(fields: [requerimientoCompraId], references: [id])
  movimientos                  DetMovsEntregaRendirPCompras[]          // TODOS los movimientos (entregas + gastos + devoluciones)
  
  @@index([respEntregaRendirId])
  @@index([entregaLiquidada])
}

model EntregaARendirPVentas {
  id                          BigInt                        @id @default(autoincrement())
  cotizacionVentasId          BigInt
  respEntregaRendirId         BigInt
  entregaLiquidada            Boolean                       @default(false)
  fechaLiquidacion            DateTime?
  fechaCreacion               DateTime                      @default(now())
  fechaActualizacion          DateTime
  centroCostoId               BigInt

  cotizacionVentas    CotizacionVentas @relation(fields: [cotizacionVentasId], references: [id])
  movimientos         DetMovsEntregaRendirPVentas[]
}

model EntregaARendirPescaConsumo {
  id                           BigInt                         @id @default(autoincrement())
  novedadPescaConsumoId        BigInt
  entregaLiquidada             Boolean                        @default(false)
  fechaLiquidacion             DateTime?
  fechaCreacion                DateTime                       @default(now())
  fechaActualizacion           DateTime
  respEntregaRendirId          BigInt
  centroCostoId                BigInt

  novedadPescaConsumo   NovedadPescaConsumo @relation(fields: [novedadPescaConsumoId], references: [id])
  movimientos           DetMovsEntRendirPescaConsumo[]
}

model EstadoMultiFuncion {
  id               BigInt          @id @default(autoincrement())
  descripcion      String?
  cesado           Boolean         @default(false)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  tipoProvieneDeId BigInt?

  tipoProvieneDe    TipoProvieneDe? @relation(fields: [tipoProvieneDeId], references: [id])
}

model FaenaPesca {
  id                      BigInt                    @id @default(autoincrement())
  temporadaId             BigInt
  descripcion             String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  bolicheRedId            BigInt?
  embarcacionId           BigInt?
  fechaSalida             DateTime?
  fechaDescarga           DateTime?
  puertoDescargaId        BigInt?
  puertoSalidaId          BigInt?
  bahiaId                 BigInt?
  motoristaId             BigInt?
  patronId                BigInt?
  urlInformeFaena         String?
  urlReporteFaenaCalas    String?
  urlDeclaracionDesembarqueArmador String?
  estadoFaenaId           BigInt?
  toneladasCapturadasFaena     Decimal?
  fechaHoraFondeo     DateTime?
  puertoFondeoId      BigInt?

  temporada       TemporadaPesca @relation("FaenaTemporadas", fields: [temporadaId], references: [id])
  embarcacion     Embarcacion?   @relation("EmbarcacionFaenas", fields: [embarcacionId], references: [id])
  boliche         BolicheRed?    @relation("BolicheFaenas", fields: [bolicheRedId], references: [id])

  detallesDoc DetalleDocEmbarcacion[]
  tripulantes     TripulanteFaena[]
  detalleDocsTripulantes DetalleDocTripulantes[]
  calas Cala[]
  descargaFaena DescargaFaenaPesca?
  accionesPrevias DetAccionesPreviasFaena[]
}

model FaenaPescaConsumo {
  id                             BigInt                           @id @default(autoincrement())
  novedadPescaConsumoId          BigInt
  descripcion                    String?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  bolicheRedId                   BigInt?
  embarcacionId                  BigInt?
  fechaSalida                    DateTime?
  fechaDescarga                  DateTime?
  puertoDescargaId               BigInt?
  puertoSalidaId                 BigInt?
  bahiaId                        BigInt?
  motoristaId                    BigInt?
  patronId                       BigInt?
  urlInformeFaena                String?
  estadoFaenaId           BigInt?
  toneladasCapturadasFaena     Decimal?
  fechaHoraFondeo     DateTime?
  puertoFondeoId      BigInt?

  novedadPescaConsumo   NovedadPescaConsumo @relation(fields: [novedadPescaConsumoId], references: [id])
  embarcacion           Embarcacion?        @relation("EmbarcacionFaenasConsumo", fields: [embarcacionId], references: [id])
  boliche               BolicheRed?         @relation("BolicheFaenasConsumo", fields: [bolicheRedId], references: [id])

  // Relaciones de detalle
  detallesDocEmbarcacion    DetDocEmbarcacionPescaConsumo[]
  tripulantes               TripulanteFaenaConsumo[]
  detalleDocsTripulantes    DetDocTripulantesFaenaConsumo[]
  calas                     CalaFaenaConsumo[]
  descargaFaenaConsumo      DescargaFaenaConsumo?
  accionesPrevias           DetAccionesPreviasFaenaConsumo[]
}

model FamiliaProducto {
  id       BigInt     @id @default(autoincrement())
  nombre   String     @db.VarChar(120)
  productos             Producto[]
}

model FormaPago {
  id               BigInt             @id @default(autoincrement())
  nombre           String             @db.VarChar(50)
  descripcion      String?
  esCliente        Boolean            @default(false)
  esProveedor      Boolean            @default(false)
  activo           Boolean            @default(true)

  entidades   EntidadComercial[]
  ordenesCompra OrdenCompra[]
  requerimientosCompra RequerimientoCompra[]

}

model Incoterm {
  id          BigInt       @id @default(autoincrement())
  codigo      String       @unique @db.VarChar(10)
  descripcion String
  activo      Boolean      @default(true)

  preFacturas PreFactura[]   // Relación inversa: todas las pre-facturas que usan este incoterm
}

model KardexAlmacen {
  id                         BigInt            @id @default(autoincrement())
  empresaId                  BigInt            // Empresa (dueña si esCustodia=false, custodia si esCustodia=true)
  almacenId                  BigInt            // Almacén físico
  productoId                 BigInt            // Producto específico
  clienteId                  BigInt            // Cliente/Proveedor de la transacción
  esCustodia                 Boolean           @default(false) // false=mercadería propia, true=mercadería en custodia
  fechaMovimientoAlmacen     DateTime          // Fecha del movimiento
  numDocCompleto             String            // Número de Movimiento documento completo
  
  esIngresoEgreso            Boolean           @default(false) // false=EGRESO, true=INGRESO
  conceptoMovAlmacenId       BigInt            // Concepto del movimiento
  movimientoAlmacenId        BigInt            // ID del movimiento de almacén
  detalleMovimientoAlmacenId BigInt            // ID del detalle del movimiento
  
  // INGRESOS (0 si no aplica)
  ingresoCant                Decimal           @default(0) // Cantidad ingresada
  ingresoCantCostoUnit       Decimal           @default(0) // Costo unitario por cantidad
  ingresoCantCostoTotal      Decimal           @default(0) // Costo total por cantidad
  ingresoCantVariables       Decimal           @default(0) // Cantidad con variables de control
  ingresoPeso                Decimal           @default(0) // Peso ingresado
  ingresoPesoCostoUnit       Decimal           @default(0) // Costo unitario por peso
  ingresoPesoCostoTotal      Decimal           @default(0) // Costo total por peso
  ingresoPesoVariables       Decimal           @default(0) // Peso con variables de control
  
  // EGRESOS (0 si no aplica)
  egresoCant                 Decimal           @default(0) // Cantidad egresada
  egresoCantCostoUnit        Decimal           @default(0) // Costo unitario por cantidad
  egresoCantCostoTotal       Decimal           @default(0) // Costo total por cantidad
  egresoCantVariables        Decimal           @default(0) // Cantidad con variables de control
  egresoPeso                 Decimal           @default(0) // Peso egresado
  egresoPesoCostoUnit        Decimal           @default(0) // Costo unitario por peso
  egresoPesoCostoTotal       Decimal           @default(0) // Costo total por peso
  egresoPesoVariables        Decimal           @default(0) // Peso con variables de control
  
  // SALDOS INICIALES (antes del movimiento)
  saldoIniCant               Decimal           @default(0) // Saldo inicial cantidad (general)
  saldoInicialCostoUnitCant  Decimal           @default(0) // Costo unitario del saldo inicial
  saldoInicialCostoTotalCant Decimal           @default(0) // Costo total del saldo inicial
  saldoInicialCantVariables  Decimal           @default(0) // Saldo inicial con variables de control
  saldoInicialPeso           Decimal           @default(0) // Saldo inicial peso (general)
  saldoInicialPesoCostoUnit  Decimal           @default(0) // Costo unitario por peso del saldo inicial
  saldoInicialPesoCostoTotal Decimal           @default(0) // Costo total por peso del saldo inicial
  saldoInicialPesoVariables  Decimal           @default(0) // Saldo inicial peso con variables de control
  
  // SALDOS FINALES (después del movimiento)
  saldoFinalCant             Decimal           @default(0) // Saldo final cantidad (general)
  saldoFinalCostoUnitCant    Decimal           @default(0) // Costo unitario del saldo final
  saldoFinalCostoTotalCant   Decimal           @default(0) // Costo total del saldo final
  saldoFinalCantVariables    Decimal           @default(0) // Saldo final con variables de control
  saldoFinalPeso             Decimal           @default(0) // Saldo final peso (general)
  saldoFinalPesoCostoUnit    Decimal           @default(0) // Costo unitario por peso del saldo final
  saldoFinalPesoCostoTotal   Decimal           @default(0) // Costo total por peso del saldo final
  saldoFinalPesoVariables    Decimal           @default(0) // Saldo final peso con variables de control
  
  // VARIABLES DE CONTROL - Trazabilidad
  lote                       String            @default("") @db.VarChar(40)  // Número de lote
  fechaVencimiento           DateTime?         // Fecha de vencimiento (null si no aplica)
  fechaProduccion            DateTime?         // Fecha de producción (null si no aplica)
  fechaIngreso               DateTime?         // Fecha de ingreso al almacén (null si no aplica)
  numContenedor              String            @default("") @db.VarChar(40)  // Número de contenedor
  nroSerie                   String            @default("") @db.VarChar(40)  // Número de serie
  estadoId                   BigInt?           // Estado de la mercadería (null si no aplica)
  estadoCalidadId            BigInt?           // Estado de calidad (null si no aplica)

  // RELACIONES
  producto           Producto           @relation(fields: [productoId], references: [id])
  cliente            EntidadComercial?  @relation(fields: [clienteId], references: [id])
  conceptoMovAlmacen ConceptoMovAlmacen @relation(fields: [conceptoMovAlmacenId], references: [id])

  // ÍNDICES OPTIMIZADOS - Ordenamiento: fecha DESC, INGRESOS primero (esIngresoEgreso DESC), id DESC
  @@index([empresaId, almacenId, productoId, esCustodia, fechaMovimientoAlmacen, esIngresoEgreso, id], name: "idx_kardex_propio_general")
  @@index([empresaId, almacenId, productoId, clienteId, esCustodia, fechaMovimientoAlmacen, esIngresoEgreso, id], name: "idx_kardex_custodia_general")
  @@index([empresaId, almacenId, productoId, esCustodia, lote, fechaIngreso, fechaProduccion, fechaVencimiento, estadoId, estadoCalidadId, numContenedor, nroSerie, fechaMovimientoAlmacen, esIngresoEgreso, id], name: "idx_kardex_propio_detallado")
  @@index([empresaId, almacenId, productoId, clienteId, esCustodia, lote, fechaIngreso, fechaProduccion, fechaVencimiento, estadoId, estadoCalidadId, numContenedor, nroSerie, fechaMovimientoAlmacen, esIngresoEgreso, id], name: "idx_kardex_custodia_detallado")
  @@index([empresaId, almacenId, fechaMovimientoAlmacen, productoId, esCustodia], name: "idx_kardex_reportes_fecha")
  @@index([productoId], name: "idx_kardex_producto")
  @@index([clienteId], name: "idx_kardex_cliente")
  @@index([movimientoAlmacenId], name: "idx_kardex_movimiento")
}

model LineaCreditoEntidad {
  id                 BigInt           @id @default(autoincrement())
  entidadComercialId BigInt
  montoMaximo        Decimal
  monedaId           BigInt
  diasCredito        Int
  vigenteDesde       DateTime
  vigenteHasta       DateTime?
  condiciones        String?
  observaciones      String?
  activo             Boolean          @default(true)

  entidadComercial   EntidadComercial @relation(fields: [entidadComercialId], references: [id])
}


model Marca {
  id       BigInt     @id @default(autoincrement())
  nombre   String     @db.VarChar(120)
  productos  Producto[]
}

model ModuloSistema {
  id               BigInt             @id @default(autoincrement())
  nombre           String             @unique
  descripcion      String?
  activo           Boolean            @default(true)

  submodulos   SubmoduloSistema[]
}

model Moneda {
  id            BigInt          @id @default(autoincrement())
  codigoSunat   String          @unique
  nombreLargo   String?
  simbolo       String?
  activo        Boolean         @default(true)

  precios    PrecioEntidad[]
  ctacte     CuentaCorriente[]
  detEntregaRendirPescaIndustrial DetMovsEntregaRendir[]
  detEntregaRendirPescaConsumo DetMovsEntRendirPescaConsumo[]
  detEntregaRendirPCompras DetMovsEntregaRendirPCompras[]
  detEntregaRendirPVentas DetMovsEntregaRendirPVentas[]
}

model MotivoAcceso {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)

  accesos     AccesoInstalacion[]
}

model MotivoOriginoOT {
  id              BigInt            @id @default(autoincrement())
  nombre          String            @db.VarChar(40)
  descripcion     String?           @db.VarChar(200)
  activo          Boolean           @default(true)

  ordenesTrabajo OTMantenimiento[]
}

model MovimientoAlmacen {
  id                       BigInt                     @id @default(autoincrement())
  empresaId                BigInt
  tipoDocumentoId          BigInt
  conceptoMovAlmacenId     BigInt
  serieDocId               BigInt?
  numSerieDoc              String?                    @db.VarChar(40)
  numCorreDoc              String?                    @db.VarChar(40)
  numeroDocumento          String?
  fechaDocumento           DateTime
  entidadComercialId       BigInt?
  faenaPescaId             BigInt?
  embarcacionId            BigInt?
  ordenTrabajoId           BigInt?
  dirOrigenId              BigInt?
  dirDestinoId             BigInt?
  numGuiaSunat             String?                    @db.VarChar(40)
  fechaGuiaSunat           DateTime?
  transportistaId          BigInt?
  vehiculoId               BigInt?
  agenciaEnvioId           BigInt?
  dirAgenciaEnvioId        BigInt?
  personalRespAlmacen      BigInt?
  ordenCompraId            BigInt?
  pedidoVentaId            BigInt?
  estadoDocAlmacenId       BigInt?
  esCustodia               Boolean                    @default(false)
  observaciones            String?
  creadoEn                 DateTime                   @default(now())
  actualizadoEn            DateTime
  creadoPor                BigInt?
  actualizadoPor           BigInt?

  empresa Empresa @relation(fields: [empresaId], references: [id])
  tipoDocumento       TipoDocumento         @relation(fields: [tipoDocumentoId], references: [id])
  conceptoMovAlmacen  ConceptoMovAlmacen    @relation(fields: [conceptoMovAlmacenId], references: [id])
  serieDoc            SerieDoc?             @relation(fields: [serieDocId], references: [id])
  entidadComercial    EntidadComercial?     @relation(fields: [entidadComercialId], references: [id])
  detalles            DetalleMovimientoAlmacen[]
  preFacturasSalida PreFactura[] @relation("MovimientoAlmacenToPreFactura")
}

model MovimientoCaja {
  id                                                                       BigInt                        @id @default(autoincrement())
  empresaOrigenId                                                          BigInt
  empresaDestinoId                                                         BigInt
  tipoMovimientoId                                                         BigInt
  entidadComercialId                                                       BigInt
  monto                                                                    Decimal
  monedaId                                                                 BigInt
  descripcion                                                              String?
  referenciaExtId                                                          String?
  tipoReferenciaId                                                         BigInt?
  usuarioId                                                                BigInt?
  estadoId                                                                 BigInt
  cuentaCorrienteDestinoId                                                 BigInt
  cuentaCorrienteOrigenId                                                  BigInt
  fechaCreacion                                                            DateTime?                      @default(now())
  fechaActualizacion                                                       DateTime?                      @default(now())
  centroCostoId                                                            BigInt?
  moduloOrigenMotivoOperacionId                                            BigInt?
  origenMotivoOperacionId                                                  BigInt?
  fechaMotivoOperacion                                                     DateTime?
  usuarioMotivoOperacionId                                                 BigInt?
  fechaOperacionMovCaja                                                  DateTime? @default(now())
  operacionSinFactura                                                  Boolean @default(false)
  urlComprobanteOperacionMovCaja String?
  urlDocumentoMovCaja String?

  cuentaCorrienteOrigen     CuentaCorriente @relation("CuentaCorrienteOrigen", fields: [cuentaCorrienteOrigenId], references: [id])
  cuentaCorrienteDestino    CuentaCorriente @relation("CuentaCorrienteDestino", fields: [cuentaCorrienteDestinoId], references: [id])
  tipoReferencia            TipoReferenciaMovimientoCaja? @relation(fields: [tipoReferenciaId], references: [id])
  asientosContables         AsientoContableInterfaz[]
  entidadComercial          EntidadComercial? @relation(fields: [entidadComercialId], references: [id])
}

model NovedadPescaConsumo {
  id                         BigInt                       @id @default(autoincrement())
  empresaId                  BigInt
  BahiaId                    BigInt
  nombre                     String
  fechaInicio                DateTime
  fechaFin                   DateTime
  fechaCreacion              DateTime                     @default(now())
  fechaActualizacion         DateTime
  estadoNovedadPescaConsumoId         BigInt
  toneladasCapturadas     Decimal?
  novedadPescaConsumoIniciada   Boolean @default(false)
  urlResolucionPdf String?
  cuotaAlquiladaTon         Decimal?
  cuotaPropiaTon            Decimal?
  numeroResolucion          String?
  referenciaExtra           String?

  faenas                FaenaPescaConsumo[]
  entregasARendir       EntregaARendirPescaConsumo[]
}

model OTMantenimiento {
  id                     BigInt                   @id @default(autoincrement())
  codigo                 String                   @unique @db.VarChar(30)
  empresaId              BigInt
  sedeId                 BigInt?
  activoId               BigInt?
  tipoMantenimientoId    BigInt
  motivoOriginoId        BigInt
  prioridadAlta          Boolean                  @default(false)
  estadoId               BigInt
  fechaCreacion          DateTime                 @default(now())
  fechaProgramada        DateTime?
  fechaInicio            DateTime?
  fechaFin               DateTime?
  solicitanteId          BigInt?
  responsableId          BigInt?
  autorizadoPorId        BigInt?
  descripcion            String?
  causa                  String?
  solucion               String?
  observaciones          String?
  actualizadoEn          DateTime
  urlFotosAntesDeOTPdf   String?
  urlFotosDespuesDeOTPdf String?
  urlOrdenTrabajoPdf     String?
  docOrigenProvieneId    BigInt?
  tipoProvieneDeId       BigInt?

  // Relaciones
  tipoMantenimiento   TipoMantenimiento   @relation(fields: [tipoMantenimientoId], references: [id])
  motivoOrigino       MotivoOriginoOT     @relation(fields: [motivoOriginoId], references: [id])
  permisosGestionados DetPermisoGestionadoOT[]
  tareas DetTareasOT[]

}

model OrdenCompra {
  id                   BigInt      @id @default(autoincrement())
  empresaId            BigInt                                   // Empresa que emite la orden
  tipoDocumentoId       BigInt                                  // Tipo de documento (Se asigna el ID 17("ORDEN DE COMPRA"))
  serieDocId               BigInt?
  numSerieDoc              String?                    @db.VarChar(40)
  numCorreDoc              String?                    @db.VarChar(40)
  numeroDocumento          String?
  fechaDocumento           DateTime @default(now())
  requerimientoCompraId BigInt?                                 // Requerimiento que originó esta orden
  proveedorId          BigInt                                   // Proveedor al que se le compra
  formaPagoId          BigInt?                                  // Forma de pago acordada
  monedaId             BigInt?                                  // Moneda de la orden
  tipoCambio           Decimal?                                 // Tipo de cambio aplicado
  fechaEntrega         DateTime?                                // Fecha comprometida de entrega
  fechaRecepcion       DateTime?                                // Fecha real de recepción
  solicitanteId        BigInt?                                  // Usuario que solicitó
  aprobadoPorId        BigInt?                                  // Usuario que aprobó la orden
  estadoId             BigInt                                   // Estado desde EstadosMultifuncion
  centroCostoId        BigInt?                                  // Centro de costo  
  movIngresoAlmacenId  BigInt?                                  // Movimiento de ingreso generado al recibir
  observaciones        String?     @db.Text                     // Notas, instrucciones especiales
  urlOrdenCompraPdf    String?                                  // PDF de la orden generada
  creadoEn             DateTime    @default(now())
  actualizadoEn        DateTime    @updatedAt
  creadoPor            BigInt?
  actualizadoPor       BigInt?
  porcentajeIGV         Decimal?                                // Porcentaje de IGV
  esExoneradoAlIGV      Boolean?   @default(false)             // Es exonerado al IGV
  
  requerimientoCompra  RequerimientoCompra? @relation(fields: [requerimientoCompraId], references: [id])
  proveedor            EntidadComercial @relation("ProveedorOrdenCompra", fields: [proveedorId], references: [id])
  formaPago            FormaPago? @relation(fields: [formaPagoId], references: [id])
  tipoDocumento        TipoDocumento @relation(fields: [tipoDocumentoId], references: [id])
  serieDoc             SerieDoc? @relation(fields: [serieDocId], references: [id])
  empresa              Empresa @relation(fields: [empresaId], references: [id])
  
  detalles             DetalleOrdenCompra[]                     // Items de la orden
  
  @@index([empresaId, fechaDocumento])
  @@index([estadoId])
  @@index([proveedorId])
  @@index([requerimientoCompraId])
}

model Pais {
  id           BigInt         @id @default(autoincrement())
  codSUNAT     String         @unique
  nombre       String
  activo       Boolean        @default(true)
  gentilicio   String?

  departamentos Departamento[]
  ubigeos       Ubigeo[]
}

model ParametroAprobador {
  id              BigInt    @id @default(autoincrement())
  personalRespId  BigInt
  moduloSistemaId BigInt
  empresaId       BigInt
  embarcacionId   BigInt?
  sedeId          BigInt?
  vigenteDesde    DateTime
  vigenteHasta    DateTime?
  cesado          Boolean   @default(false)
}

model PermisoAutorizacion {
  id                   BigInt                 @id @default(autoincrement())
  nombre               String                 @unique @db.VarChar(80)
  descripcion          String?
  activo               Boolean                @default(true)

  activosPermiso DetallePermisoActivo[]
}

model DetallePermisoActivo {
  id                  BigInt              @id @default(autoincrement())
  activoId            BigInt
  permisoId           BigInt
  observaciones       String?
  obligatorio         Boolean             @default(true)

  activo         Activo              @relation(fields: [activoId], references: [id])
  permiso        PermisoAutorizacion @relation(fields: [permisoId], references: [id])

  @@unique([activoId, permisoId])
}

model Personal {
  id                    BigInt                  @id @default(autoincrement())
  empresaId             BigInt
  nombres               String
  apellidos             String
  tipoDocumentoId       BigInt?
  numeroDocumento       String
  fechaNacimiento       DateTime
  sexo                  Boolean                 @default(false)
  direccion             String?
  telefono              String?
  correo                String?
  fechaIngreso          DateTime?
  fechaCese             DateTime?
  tipoContratoId        BigInt?
  cargoId               BigInt?
  cesado                Boolean                 @default(false)
  areaFisicaId          BigInt?
  sedeEmpresaId         BigInt?
  urlFotoPersona        String?
  ubigeoId              BigInt?
  esVendedor            Boolean                 @default(false)
  paraPescaConsumo      Boolean                 @default(false)
  paraTemporadaPesca    Boolean                 @default(false)
  usuario       Usuario?
  
  documentaciones DocumentacionPersonal[]
  cargo       CargosPersonal?    @relation(fields: [cargoId], references: [id])
  ubigeo      Ubigeo?            @relation(fields: [ubigeoId], references: [id])
  tipoContrato TipoContrato?      @relation(fields: [tipoContratoId], references: [id])
  tipoDocIdentidad TiposDocIdentidad? @relation(fields: [tipoDocumentoId], references: [id])
}

model PreFactura {
  id                           BigInt              @id @default(autoincrement())
  codigo                       String              @unique @db.VarChar(30)
  empresaId                    BigInt
  clienteId                    BigInt
  ordenCompraCliente           String?
  movSalidaAlmacenId           BigInt?
  esExportacion                Boolean             @default(false)
  paisDestinoId                BigInt?
  puertoCargaId                BigInt?
  puertoDescargaId             BigInt?
  incotermId                   BigInt?
  agenteAduanaId               BigInt?
  bancoId                      BigInt?
  numeroBuque                  String?
  numeroBL                     String?
  numContenedor                String?
  exoneradoIgv                 Boolean             @default(false)
  porcentajeIgv                Decimal?
  fechaEmision                 DateTime            @default(now())
  fechaVencimiento             DateTime?
  estadoId                     BigInt
  monedaId                     BigInt?
  tipoCambio                   Decimal?
  observaciones                String?
  urlPreFacturaPdf             String?
  actualizadoEn                DateTime
  fechaTransfErpContable       DateTime?
  numIdTransfErpContable       String?
  personaRespTransfErpContable BigInt?
  centroCostoId                BigInt?
  precioVentaTotal             Decimal?
  totalIGV                     Decimal?
  valorVentaTotal              Decimal?
  dirEntregaId                 BigInt
  dirFiscalId                  BigInt

  cliente EntidadComercial @relation("EntidadComercialToPreFactura", fields: [clienteId], references: [id])
  detalles            DetallePreFactura[]
  movSalidaAlmacen MovimientoAlmacen? @relation("MovimientoAlmacenToPreFactura", fields: [movSalidaAlmacenId], references: [id])
  incoterm            Incoterm?          @relation(fields: [incotermId], references: [id])
}

model PrecioEntidad {
  id                 BigInt           @id @default(autoincrement())
  entidadComercialId BigInt
  productoId         BigInt
  monedaId           BigInt
  precioUnitario     Decimal
  vigenteDesde       DateTime
  vigenteHasta       DateTime?
  observaciones      String?
  activo             Boolean          @default(true)

  entidadComercial   EntidadComercial @relation(fields: [entidadComercialId], references: [id])
  moneda             Moneda           @relation(fields: [monedaId], references: [id])
}

model Producto {
  codigo                            String?                             @unique @db.VarChar(40)
  id                                BigInt                              @id @default(autoincrement())
  clienteId                         BigInt
  colorId                           BigInt
  descripcionArmada                 String
  descripcionBase                   String                              @db.VarChar(120)
  descripcionExtendida              String?                             @db.VarChar(120)
  estadoInicialId                   BigInt
  exoneradoIgv                      Boolean                             @default(false)
  familiaId                         BigInt
  fechaActualizacion                DateTime
  fechaCreacion                     DateTime                            @default(now())
  marcaId                           BigInt
  porcentajeDetraccion              Decimal?
  procedenciaId                     BigInt
  subfamiliaId                      BigInt
  tipoAlmacenamientoId              BigInt
  tipoMaterialId                    BigInt
  unidadAltoId                      BigInt?
  unidadAnchoId                     BigInt?
  unidadAnguloId                    BigInt?
  unidadDiametroId                  BigInt?
  unidadEspesorId                   BigInt?
  unidadLargoId                     BigInt?
  unidadMedidaId                    BigInt
  exoneradoRetencion                Boolean                             @default(false)
  sujetoDetraccion                  Boolean                             @default(false)
  empresaId                         BigInt
  aplicaColor                       Boolean                             @default(false)
  aplicaMarca                       Boolean                             @default(false)
  aplicaProcedencia                 Boolean                             @default(false)
  aplicaSubfamilia                  Boolean                             @default(false)
  aplicaTipoAlmacenamiento          Boolean                             @default(false)
  aplicaTipoMaterial                Boolean                             @default(false)
  aplicaUnidadMedida                Boolean                             @default(false)
  medidaAlto                        String?                             @db.VarChar(20)
  medidaAncho                       String?                             @db.VarChar(20)
  medidaAngulo                      String?                             @db.VarChar(20)
  medidaDiametro                    String?                             @db.VarChar(20)
  medidaEspesor                     String?                             @db.VarChar(20)
  medidaLargo                       String?                             @db.VarChar(20)
  urlFichaTecnica                   String?
  urlFotoProducto                   String?
  descripcionMedidaAdicional        String?                             @db.VarChar(120)
  especieId BigInt?
  cesado Boolean @default(false)

familia                 FamiliaProducto      @relation(fields: [familiaId], references: [id])
  subfamilia              SubfamiliaProducto?  @relation(fields: [subfamiliaId], references: [id])
  unidadMedida            UnidadMedida         @relation("UnidadMedidaToProducto", fields: [unidadMedidaId], references: [id])
  tipoMaterial            TipoMaterial?        @relation(fields: [tipoMaterialId], references: [id])
  color                   Color?               @relation(fields: [colorId], references: [id])
  tipoAlmacenamiento      TipoAlmacenamiento   @relation(fields: [tipoAlmacenamientoId], references: [id])
  marca                   Marca                @relation(fields: [marcaId], references: [id])
  detallesMovimiento      DetalleMovimientoAlmacen[]
  kardexAlmacenes   KardexAlmacen[]
  insumosTareaOT DetInsumosTareaOT[]
  detallesRequerimientosCompra DetalleReqCompra[]
  cotizacionesProveedores CotizacionProveedor[]
  detallesOrdenCompra     DetalleOrdenCompra[]
  detallesPreFactura DetallePreFactura[]
  detallesCotizacionVentas DetCotizacionVentas[]
  saldosDetProductoCliente SaldosDetProductoCliente[]
  saldosProductoCliente SaldosProductoCliente[]
}

model Provincia {
  id             BigInt       @id @default(autoincrement())
  codSUNAT       String       @unique
  nombre         String
  departamentoId BigInt

  departamento    Departamento @relation(fields: [departamentoId], references: [id])
  ubigeos         Ubigeo[]
}

model PuertoPesca {
  id                  BigInt   @id @default(autoincrement())
  zona                String   @db.VarChar(20)
  nombre              String   @db.VarChar(100)
  provincia           String?
  departamento        String?
  latitud             Decimal?
  longitud            Decimal?
  activo              Boolean  @default(true)
  fecha_creacion      DateTime @default(now())
  fecha_actualizacion DateTime
}

model RefreshToken {
  id         BigInt   @id @default(autoincrement())
  token      String   @unique
  usuarioId  BigInt
  expiracion DateTime
  creadoEn   DateTime @default(now())
  revocado   Boolean  @default(false)

  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
}

/// Modelo profesional para almacenar los metadatos de los archivos de reportes generados por el sistema.
/// Cada registro representa un archivo de reporte generado y almacenado en el backend,
/// asociado a una empresa y opcionalmente a un submódulo o proceso específico.
/// Documentado profesionalmente en español técnico.
model ReporteGenerado {
  id                BigInt    @id @default(autoincrement()) // Identificador único del reporte generado
  nombreArchivo     String    // Nombre físico del archivo almacenado (incluye extensión)
  rutaRelativa      String    // Ruta relativa donde se guarda el archivo, siguiendo la convención /uploads/reportes/empresa-{idEmpresa}/
  fechaGeneracion   DateTime  @default(now()) // Fecha y hora de la generación y almacenamiento del reporte
  empresaId         BigInt    // Empresa propietaria del reporte generado
  subModuloId       BigInt?   // Submódulo o proceso origen del reporte (ej: id de faena, id de liquidación, etc.)
  usuarioGeneroId   BigInt?   // Usuario que generó el reporte (opcional, para trazabilidad/auditoría)

  @@index([empresaId])
  @@index([subModuloId])
}

model SaldosDetProductoCliente {
  id               BigInt    @id @default(autoincrement())
  empresaId        BigInt    // Empresa (dueña si esCustodia=false, custodia si esCustodia=true)
  almacenId        BigInt    // Almacén físico donde está el producto
  productoId       BigInt    // Producto específico
  clienteId        BigInt    // Cliente/Proveedor - Siempre tiene valor (entidadComercialId de la empresa o cliente real)
  esCustodia       Boolean   @default(false) // false=mercadería propia, true=mercadería en custodia
  
  // Variables de Control - Trazabilidad completa
  lote             String    @default("") @db.VarChar(40)  // Número de lote de producción
  fechaVencimiento DateTime? // Fecha de vencimiento del producto (null si no aplica)
  fechaProduccion  DateTime? // Fecha de producción (null si no aplica)
  fechaIngreso     DateTime? // Fecha de ingreso al almacén (null si no aplica)
  numContenedor    String    @default("") @db.VarChar(40)  // Número de contenedor (importaciones)
  nroSerie         String    @default("") @db.VarChar(40)  // Número de serie (productos individuales)
  estadoId         BigInt?   // Estado de la mercadería (null si no aplica)
  estadoCalidadId  BigInt?   // Estado de calidad (null si no aplica)
  
  // Saldos - Siempre valores numéricos
  saldoCantidad    Decimal   @default(0) // Saldo en unidades
  saldoPeso        Decimal   @default(0) // Saldo en peso
  actualizadoEn    DateTime  // Última actualización del saldo

  // RELACIONES
  producto Producto         @relation(fields: [productoId], references: [id])
  cliente  EntidadComercial @relation(fields: [clienteId], references: [id])

  // ❌ CONSTRAINT ÚNICO ELIMINADO: PostgreSQL no maneja bien nulls en constraints únicos compuestos
  // Solución profesional: Usar findFirst + update/create en lugar de upsert
  
  // ✅ ÍNDICES OPTIMIZADOS para performance (sin restricción de unicidad)
  @@index([empresaId, almacenId, productoId, esCustodia, lote, fechaIngreso, fechaProduccion, fechaVencimiento, estadoId, estadoCalidadId, numContenedor, nroSerie], name: "idx_saldo_det_propio_completo")
  @@index([empresaId, almacenId, productoId, clienteId, esCustodia, lote, fechaIngreso, fechaProduccion, fechaVencimiento, estadoId, estadoCalidadId, numContenedor, nroSerie], name: "idx_saldo_det_custodia_completo")
  @@index([empresaId, almacenId, productoId, esCustodia], name: "idx_saldo_det_general")
}

model SaldosProductoCliente {
  id                    BigInt   @id @default(autoincrement())
  empresaId             BigInt   // Empresa (dueña si custodia=false, custodia si custodia=true)
  almacenId             BigInt   // Almacén físico
  productoId            BigInt   // Producto específico
  clienteId             BigInt   // Cliente/Proveedor - Siempre tiene valor (entidadComercialId de la empresa o cliente real)
  custodia              Boolean  @default(false) // false=mercadería propia, true=mercadería en custodia
  
  // Saldos Generales (sin variables de control) - Siempre valores numéricos
  saldoCantidad         Decimal  @default(0) // Saldo total en unidades
  saldoPeso             Decimal  @default(0) // Saldo total en peso
  costoUnitarioPromedio Decimal  @default(0) // Costo promedio ponderado (solo para mercadería propia)
  actualizadoEn         DateTime // Última actualización

  // RELACIONES
  producto Producto         @relation(fields: [productoId], references: [id])
  cliente  EntidadComercial @relation(fields: [clienteId], references: [id])

  // ✅ CONSTRAINT ÚNICO válido (sin campos nullables)
  @@unique([empresaId, almacenId, productoId, clienteId, custodia], name: "uk_saldo_general_completo")
  
  // ÍNDICES OPTIMIZADOS
  @@index([empresaId, almacenId, productoId, custodia], name: "idx_saldo_gen_propio")
  @@index([empresaId, almacenId, productoId, clienteId, custodia], name: "idx_saldo_gen_cliente")
}

model SedesEmpresa {
  id             BigInt           @id @default(autoincrement())
  empresaId      BigInt
  nombre         String
  direccion      String?
  telefono       String?
  email          String?
  cesado         Boolean          @default(false)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime

 empresa     Empresa  @relation(fields: [empresaId], references: [id])
  areasFisicas AreaFisicaSede[]
}

model SerieDoc {
  id                BigInt              @id @default(autoincrement())
  tipoDocumentoId   BigInt
  tipoAlmacenId     BigInt
  serie             String              @db.VarChar(20)
  correlativo       BigInt              @default(0)
  numCerosIzqCorre  Int                 @default(0)
  numCerosIzqSerie  Int                 @default(0)
  activo            Boolean             @default(true)
  empresaId         BigInt?

  movimientos       MovimientoAlmacen[]
  requerimientosCompra RequerimientoCompra[]
  ordenesCompra OrdenCompra[]
}

model SubfamiliaProducto {
  familiaId BigInt
  id        BigInt     @id @default(autoincrement())
  nombre    String     @db.VarChar(120)
  productos  Producto[]
}

model SubmoduloSistema {
  id             BigInt           @id @default(autoincrement())
  moduloId       BigInt
  nombre         String
  descripcion    String?
  activo         Boolean          @default(true)

  modulo         ModuloSistema @relation(fields: [moduloId], references: [id])
  accesosUsuario AccesosUsuario[]
}

model TemporadaPesca {
  id                        BigInt                     @id @default(autoincrement())
  nombre                    String
  fechaInicio               DateTime
  fechaFin                  DateTime
  cuotaAlquiladaTon         Decimal?
  cuotaPropiaTon            Decimal?
  empresaId                 BigInt
  fechaActualizacion        DateTime
  fechaCreacion             DateTime                   @default(now())
  numeroResolucion          String?
  urlResolucionPdf          String?
  BahiaId                   BigInt
  estadoTemporadaId         BigInt
  toneladasCapturadasTemporada     Decimal?
  temporadaPescaIniciada   Boolean @default(false)

  faenas               FaenaPesca[] @relation("FaenaTemporadas")
  entregasARendir      EntregaARendir[]
}

model TipoAccesoInstalacion {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)

  accesos     AccesoInstalacion[]
}

model TipoActivo {
  id          BigInt   @id @default(autoincrement())
  codigo      String   @unique
  nombre      String
  descripcion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  cesado      Boolean  @default(false)

  activos     Activo[]
}

model TipoAlmacen {
  id                 BigInt               @id @default(autoincrement())
  nombre             String               @db.VarChar(50)
  descripcion        String?
  activo             Boolean              @default(true)

  conceptos   ConceptoMovAlmacen[]
  almacenes   Almacen[]
}

model TipoAlmacenamiento {
  id       BigInt     @id @default(autoincrement())
  nombre   String     @db.VarChar(120)
  productos  Producto[]
  almacenes  Almacen[]
}

model TipoConcepto {
  id                 BigInt               @id @default(autoincrement())
  nombre             String               @db.VarChar(50)
  descripcion        String?
  activo             Boolean              @default(true)

  conceptos   ConceptoMovAlmacen[]
}

model TipoContrato {
  id        BigInt     @id @default(autoincrement())
  codigo    String     @unique
  nombre    String
  cesado    Boolean    @default(false)
  createdAt DateTime   @default(now())
  updatedAt DateTime

  personal Personal[]
}

model TipoCuentaCorriente {
  id              BigInt            @id @default(autoincrement())
  nombre          String            @unique
  descripcion     String?
  activo          Boolean           @default(true)

  cuentas     CuentaCorriente[]
}

model TipoDocumento {
  id                BigInt              @id @default(autoincrement())
  codigo            String              @unique @db.VarChar(10)
  codigoSunat       String?             @db.VarChar(10)
  descripcion       String?
  activo            Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  esParaAlmacen     Boolean             @default(false)
  esParaCompras     Boolean             @default(false)
  esParaVentas      Boolean             @default(false)

  movimientosAlmacen MovimientoAlmacen[]
  detMovsEntregaRendirPCompras DetMovsEntregaRendirPCompras[]
  detMovsEntregaRendirPVentas DetMovsEntregaRendirPVentas[]
  requerimientosCompra RequerimientoCompra[]
  ordenesCompra OrdenCompra[]
  detMovsEntregaRendirPescaConsumo DetMovsEntRendirPescaConsumo[]
  detMovsEntregaRendir DetMovsEntregaRendir[]
}

model TipoEmbarcacion {
  id          BigInt        @id @default(autoincrement())
  codigo      String        @unique
  nombre      String
  descripcion String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  cesado      Boolean       @default(false)

  embarcaciones Embarcacion[]
}

model TipoEntidad {
  id               BigInt             @id @default(autoincrement())
  descripcion      String?
  activo           Boolean            @default(true)
  esCliente        Boolean            @default(false)
  esProveedor      Boolean            @default(false)
  nombre           String             @db.VarChar(50)

  entidades   EntidadComercial[]
}

model TipoEquipo {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)

  accesos     AccesoInstalacion[]
}

model TipoMantenimiento {
  id              BigInt            @id @default(autoincrement())
  nombre          String            @db.VarChar(40)
  descripcion     String?           @db.VarChar(200)
  activo          Boolean           @default(true)

  ordenesTrabajo OTMantenimiento[]
}

model TipoMaterial {
  id       BigInt     @id @default(autoincrement())
  nombre   String     @db.VarChar(80)
  codigo   String     @db.VarChar(10)

  productos               Producto[]
}

model TipoMovEntregaRendir {
  id                           BigInt                         @id @default(autoincrement())
  nombre                       String                         @db.VarChar(50)
  descripcion                  String?
  esIngreso                    Boolean
  activo                       Boolean                        @default(true)

  detMovsEntregaRendir DetMovsEntregaRendir[]
  movimientosConsumo DetMovsEntRendirPescaConsumo[]
  movimientosVentas DetMovsEntregaRendirPVentas[]
  movimientosCompras DetMovsEntregaRendirPCompras[]
}

model TipoMovimientoAcceso {
  id                       BigInt                     @id @default(autoincrement())
  nombre                   String                     @unique
  descripcion              String?
  activo                   Boolean                    @default(true)

  detalles    AccesoInstalacionDetalle[]
}

model TipoMovimientoAlmacen {
  id                 BigInt               @id @default(autoincrement())
  nombre             String               @db.VarChar(30)
  descripcion        String?
  activo             Boolean              @default(true)

  conceptos   ConceptoMovAlmacen[]
}

model TipoPersona {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)
  imprimeTicketIng  Boolean             @default(true)

  accesos     AccesoInstalacion[]
}

model TipoProducto {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)
  paraCompras       Boolean             @default(false)
  paraVentas        Boolean             @default(false)

  cotizaciones          CotizacionVentas[]
  requerimientosCompra  RequerimientoCompra[]
}

model TipoEstadoProducto {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)
  paraCompras       Boolean             @default(false)
  paraVentas        Boolean             @default(false)

  cotizaciones          CotizacionVentas[]
  requerimientosCompra  RequerimientoCompra[]
}

model DestinoProducto {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)
  paraCompras       Boolean             @default(false)
  paraVentas        Boolean             @default(false)

  cotizaciones          CotizacionVentas[]
  requerimientosCompra  RequerimientoCompra[]
}

model FormaTransaccion {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)

  cotizaciones   CotizacionVentas[]
}

model ModoDespachoRecepcion {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @unique
  descripcion       String?
  activo            Boolean             @default(true)

  cotizaciones          CotizacionVentas[]
  requerimientosCompra  RequerimientoCompra[]
}

model TipoProvieneDe {
  id                 BigInt               @id @default(autoincrement())
  descripcion        String?
  cesado             Boolean              @default(false)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime

  estados     EstadoMultiFuncion[]
}

model TipoReferenciaMovimientoCaja {
  id             BigInt           @id @default(autoincrement())
  codigo         String           @unique @db.VarChar(30)
  descripcion    String?
  activo         Boolean          @default(true)

  movimientos MovimientoCaja[]
}

model TipoVehiculo {
  id              BigInt            @id @default(autoincrement())
  nombre          String            @db.VarChar(50)
  activo          Boolean           @default(true)

  vehiculos   VehiculoEntidad[]
}

model TiposDocIdentidad {
  id               BigInt             @id @default(autoincrement())
  codigo           String             @unique
  nombre           String
  cesado           Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  codSunat         String

  entidadesComerciales EntidadComercial[]
  personal Personal[]
}

model TripulanteFaena {
  id            BigInt     @id @default(autoincrement())
  faenaPescaId  BigInt
  personalId    BigInt?
  cargoId       BigInt?
  nombres       String?
  apellidos     String?
  observaciones String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime

  faenaPesca   FaenaPesca @relation(fields: [faenaPescaId], references: [id])
}

model TripulanteFaenaConsumo {
  id                  BigInt            @id @default(autoincrement())
  faenaPescaConsumoId BigInt
  personalId          BigInt?
  cargoId             BigInt?
  nombres             String?
  apellidos           String?
  observaciones       String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime

faenaPescaConsumo    FaenaPescaConsumo @relation(fields: [faenaPescaConsumoId], references: [id])
}

model Ubigeo {
  id               BigInt             @id @default(autoincrement())
  codigo           String             @unique
  activo           Boolean            @default(true)
  departamentoId   BigInt
  paisId           BigInt
  provinciaId      BigInt
  nombreDistrito   String?

  pais         Pais         @relation(fields: [paisId], references: [id])
  departamento Departamento @relation(fields: [departamentoId], references: [id])
  provincia    Provincia    @relation(fields: [provinciaId], references: [id])

  direcciones  DireccionEntidad[]
  personas     Personal[]
}

model UnidadMedida {
  nombre           String     @db.VarChar(60)
  simbolo          String     @db.VarChar(20)
  id               BigInt     @id @default(autoincrement())
  esMedidaMetrica  Boolean    @default(false)
  factorConversion Decimal?

  productos           Producto[]      @relation("UnidadMedidaToProducto")
}

model Usuario {
  id                BigInt           @id @default(autoincrement())
  username          String           @unique
  passwordHash      String
  cesado            Boolean
  fechaCreacion     DateTime         @default(now())
  fechaUltimoAcceso DateTime?
  personalId        BigInt?          @unique
  empresaId         BigInt
  esAdmin           Boolean          @default(false)
  esSuperUsuario    Boolean          @default(false)
  esUsuario         Boolean          @default(true)

  personal          Personal? @relation(fields: [personalId], references: [id])
  accesosUsuario    AccesosUsuario[]
  refreshTokens     RefreshToken[]
}

model VehiculoEntidad {
  id                 BigInt           @id @default(autoincrement())
  entidadComercialId BigInt
  placa              String           @db.VarChar(20)
  marca              String?
  modelo             String?
  color              String?
  anio               Int?
  tipoVehiculoId     BigInt
  capacidadTon       Decimal?
  numeroSerie        String?
  numeroMotor        String?
  cesado             Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  activoId           BigInt?
  observaciones      String?

  entidadComercial   EntidadComercial @relation(fields: [entidadComercialId], references: [id])
  tipoVehiculo       TipoVehiculo     @relation(fields: [tipoVehiculoId], references: [id])
}

model detDocsReqCotizaVentas {
  id                        BigInt                    @id @default(autoincrement())
  cotizacionVentasId        BigInt
  docRequeridaVentasId      BigInt
  numeroDocumento           String?
  fechaEmision              DateTime?
  fechaVencimiento          DateTime?
  urlDocumento              String?
  observaciones             String?
  verificado                Boolean
  creadoEn                  DateTime                  @default(now())
  actualizadoEn             DateTime

  cotizacionVentas     CotizacionVentas @relation(fields: [cotizacionVentasId], references: [id])
  docRequeridaVentas      DocRequeridaComprasVentas @relation(fields: [docRequeridaVentasId], references: [id])
}
